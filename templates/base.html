{% load static %}
<!doctype html>
<html lang="ko" data-bs-theme="dark">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
  <link rel="stylesheet" href="{% static 'css/style.css' %}">

  <title>{% block title %}StudyLog{% endblock %}</title>

  <style>
    .hero {
      background: linear-gradient(135deg, rgba(255,255,255,.05), rgba(255,255,255,0));
      border: 1px solid rgba(255,255,255,.1);
    }
    .hover-lift {
      transition: transform .15s ease, box-shadow .15s ease;
    }
    .hover-lift:hover {
      transform: translateY(-2px);
      box-shadow: 0 .5rem 1rem rgba(0,0,0,.08);
    }

    .text-truncate-2 {
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }
    .text-truncate-3{
      display: -webkit-box;
      -webkit-line-clamp: 3;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }
    .break-anywhere{
      overflow-wrap: anywhere;
      word-break: break-word;
    }
  </style>
</head>

<body>

<nav class="navbar navbar-expand-lg bg-dark border-bottom sticky-top">
  <div class="container py-2">
    <a class="navbar-brand fw-bold d-flex align-items-center gap-2" href="{% url 'home' %}">
      <i class="bi bi-journal-richtext"></i>
      <span>StudyLog</span>
    </a>

    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#topNav" aria-controls="topNav" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="topNav">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0">
        <li class="nav-item">
          <a class="nav-link" href="{% url 'home' %}"><i class="bi bi-house"></i> Home</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="{% url 'about' %}"><i class="bi bi-info-circle"></i> About</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="{% url 'contact' %}"><i class="bi bi-chat-dots"></i> Contact</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="{% url 'note_list' %}"><i class="bi bi-journal-text"></i> Notes</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="{% url 'post_list' %}"><i class="bi bi-newspaper"></i> Posts</a>
        </li>
      </ul>

      <form class="d-flex me-lg-2 my-2 my-lg-0" role="search" method="get" action="{% url 'post_list' %}">
        <input class="form-control form-control-sm" type="search" name="q" placeholder="검색어 입력…" aria-label="Search">
        <button class="btn btn-outline-light btn-sm ms-2" type="submit">
          <i class="bi bi-search"></i>
        </button>
      </form>

      <div class="d-flex gap-2">
        <a class="btn btn-outline-light btn-sm" href="/admin/">
          <i class="bi bi-shield-lock"></i> Admin
        </a>
      </div>
    </div>
  </div>
</nav>

{# ✅ Hero/사이드바는 이제 home에서만 #}
{% if request.resolver_match and request.resolver_match.url_name == "home" %}

<header class="container py-4">
  <div class="hero rounded-4 p-4 p-md-5 hover-lift">
    <div class="row align-items-center g-3">
      <div class="col-md-8">
        <h1 class="display-6 fw-bold mb-2">StudyLog</h1>
        <p class="text-secondary mb-3">
          .
        </p>
        <div class="d-flex flex-wrap gap-2">
          <a class="btn btn-primary" href="{% url 'post_list' %}">
            <i class="bi bi-list-ul"></i> 글 목록 보기
          </a>
          <a class="btn btn-outline-success" href="{% url 'post_create' %}">
            <i class="bi bi-plus-circle"></i> 새 글 작성
          </a>
        </div>
      </div>

      <div class="col-md-4">
        <div class="rounded-4 p-3 border">
          <div class="d-flex align-items-center gap-3">
            <div class="rounded-circle bg-primary-subtle d-flex align-items-center justify-content-center" style="width:52px;height:52px;">
              <i class="bi bi-person-fill text-primary fs-4"></i>
            </div>
            <div>
              <div class="fw-bold">유현기</div>
              <div class="text-secondary small">집가고싶다..</div>
            </div>
          </div>
          <hr class="my-3">
          <div class="d-flex gap-2 flex-wrap">
            <span class="badge text-bg-primary">Python</span>
            <span class="badge text-bg-success">Django</span>
            <span class="badge text-bg-warning">Study</span>
          </div>
        </div>
      </div>
    </div>
  </div>
</header>

{% endif %}

{# ✅ content block은 1번만, 레이아웃만 home에서만 사이드바 #}
{% if request.resolver_match and request.resolver_match.url_name == "home" %}
<main class="container pb-5">
  <div class="row g-4">
    <section class="col-lg-8">
{% else %}
<main class="container pb-5 pt-4">
  <div class="row justify-content-center">
    <section class="col-12 col-lg-10 col-xl-8">
{% endif %}

      {% block content %}{% endblock %}

    </section>

{% if request.resolver_match and request.resolver_match.url_name == "home" %}
    <aside class="col-lg-4">
      <div class="card border hover-lift mb-3">
        <div class="card-body">
          <h5 class="card-title mb-2"><i class="bi bi-stars"></i> 한 줄 소개</h5>
          <p class="text-secondary mb-0">오늘 배운 걸 내일의 나에게 남기는 공간.</p>
        </div>
      </div>

      <div class="card border hover-lift mb-3">
        <div class="card-body">
          <h6 class="fw-bold mb-3"><i class="bi bi-clock-history"></i> 최근 글</h6>
          <div class="list-group list-group-flush">
            {% for p in recent_posts %}
              <a href="{% url 'post_detail' p.pk %}" class="list-group-item list-group-item-action">
                <div class="fw-semibold text-truncate">{{ p.title }}</div>
                <div class="text-secondary small text-truncate-2">
                  {{ p.created_at|date:"Y-m-d" }} · {{ p.content|striptags|truncatewords:18 }}
                </div>
              </a>
            {% empty %}
              <div class="text-secondary small">아직 글이 없어요.</div>
            {% endfor %}
          </div>
        </div>
      </div>

      <div class="card border hover-lift">
        <div class="card-body">
          <h6 class="fw-bold mb-3"><i class="bi bi-bookmark-star"></i> 카테고리</h6>
          <div class="list-group list-group-flush">
            <a href="{% url 'post_list' %}" class="list-group-item list-group-item-action">
              전체보기
            </a>
            {% for c in categories %}
              <a href="{{ c.get_absolute_url }}" class="list-group-item list-group-item-action">
                {{ c.name }}
              </a>
            {% endfor %}
          </div>
        </div>
      </div>
    </aside>
{% endif %}

  </div>
</main>

<footer class="border-top bg-dark">
  <div class="container py-4 d-flex flex-column flex-md-row justify-content-between gap-2">
    <div class="text-secondary small">© {% now "Y" %} StudyLog</div>
    <div class="text-secondary small">Made with Django + Bootstrap</div>
  </div>
</footer>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
